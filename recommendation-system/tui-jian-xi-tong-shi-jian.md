# 推荐系统实践

## 1. 推荐系统概述

推荐系统的作用就是facing information overload，联系用户和信息，一方面为用户找到感兴趣的信息，另一方面为信息找到对应的用户。根据二八法则，80%的销售额来自20%的主要品牌，但根据long tail，长尾商品的销售代表个性化需求，这正是推荐系统所解决的问题。

前提条件：信息过载和用户没有明确的需求

推荐系统的三个信息来源：

* 朋友
* 历史兴趣：相关推荐，典型应用为打包销售**cross selling，**额外产生20%-35%的收入
  * 购买了这个商品的用户也经常购买的其他商品
  * 浏览过这个商品的用户经常购买的其他商品
* 注册信息

推荐系统构成的三个部分：前台展示页面，后台系统日志和算法

### 1.1 评估方法

评估方法的性能指标并不是决定性的，首先应该满足产品的需求，如果需要提供推荐解释，则只能选择ItemCF。其次需要看实现代价，若用户太多很难计算用户相似度矩阵，也只能使用ItemCF。最后离线指标和点击率等在线指标不一定成正比。

* 预测准确度。
  * 评分预测：RMSE（平方项加大了对预测不准的评分的惩罚，因而系统的评测更严苛），MAE（绝对值，如果评分系统基于整数建立，预测结果取整会降低MAE的误差）
  * **TopN推荐。**precision/recall，一般选取不同的推荐列表长度N，算出一组precision/recall，并画出曲线。有时候评分并没有用，推荐的目的是让用户感兴趣，**所以TopN可能更有用**
* 好的推荐系统不仅能准确预测，更能扩展用户的视野，挖掘兴趣
* 覆盖率coverage。推荐出来的物品占总物品集合的比例。
  * 简单定义： $$coverage=\frac{|UR(u)|}{I}$$ 其中R\(u\)是长度为N的推荐列表，coverage=100%表示将每个物品都推荐给至少一个客户。另外热门商品在总物品中占比很低，所以coverage很低。好的推荐系统要有较高的coverage
  * 更合理的定义：研究物品在推荐列表中出现次数的分布，如果出现次数差不多（分布比较平），推荐系统挖掘长尾的能力越好。如果分布陡峭，则coverage较低。
    * 信息熵 $$H=-\sum{p(i)logp(i)}$$ , p\(i\)是物品i的流行度/所有物品流行度之和
    * Gini index。 $$G=\frac{1}{n-1}\sum{(2j-n-1)p(i_j)}$$， $$i_j$$ 是按照物品流行度p从小到大排序的物品列表中第j个物品。

![](../.gitbook/assets/image%20%2847%29.png)

* 推荐系统的马太效应。马太效应：强者越强，弱者越弱。首页的热门排行榜（PageRank）就是马太效应。推荐系统的初衷是希望消除马太效应，但主流的推荐算法（如协同过滤）是具有马太效应的。用Gini index评估是否具有马太效应。
* 多样性。如果推荐列表只能覆盖用户的一个兴趣点，且这个兴趣点不是用户此刻的兴趣点，推荐列表就不会让用户满意。多样性描述了推荐列表物品两两之间的不相似性，假设 $$s(i, j)\in[0,1]$$ 定义了物品i和j之间的相似度，那么用户u的推荐列表R\(u\)的多样性定义为 $$Diversity=1-\frac{\sum{s(i,j)}}{\frac{1}{2}|R(u)|(|R(u)|-1)}$$。假设一个用户80%喜欢动作片20%喜欢动画片。推荐列表A有10部动作片没有动画片，B有10部动画片没有动作片，C有8部动作片2部动画片，D有5部动作片5部动画片。C最好，既考虑多样性又考虑比例；B最差，既没有多样性又推荐的是低比例内容。 
* 新颖性。推荐没有听过的内容。
* 惊喜度serendipity。如果一个推荐列表和用户历史无关，但又让客户觉得满意，这就是惊喜度。首先定义推荐结果和用户历史喜欢物品的相似度，其次定义用户对推荐结果的满意度。
* 信任度。如果用户信任推荐系统，可以增加交互度。增加推荐机制透明度transparency，如提供推荐解释。另外可以利用好友信息做推荐，从而让好友解释。
* 实时性。实时更新推荐列表满足用户新的行为变化。将新加入系统的物品推荐给用户。
* 鲁棒性。衡量抵抗作弊的能力。

## 2. 利用用户行为数据

即使用户主动输入他的兴趣，也不一定会得到正确的反馈：1、用户的自然语言理解；2、用户的兴趣不断变化；3、用户自己也很难描绘准确需求。所以需要通过算法自动挖掘用户行为

### 2.1 用户行为数据

通过在log中的用户行为，通常可以分为两种反馈，显性和隐性

* explicit feedback：评分和喜欢与否。如Youtube用户主要将精力放在视频上，只有在特别不满或特别满意时才评分，所以只需要喜欢和不喜欢。但如果是评论性的网站，用户主要将精力放在评论上，需要多级评分。
* implicit feedback：不能明确反应用户喜好的行为，如页面浏览，但也不一定代表用户喜欢，且数据量庞大。

### 2.2 用户行为分析

#### 2.2.1 用户活跃度和物品流行度的分布——长尾

令 $$f_u(k)$$为对k个物品产生过行为的用户， $$f_i(k)$$为对k个用户产生过行为的物品数。它们都满足长尾分布。$$f_u(k)=\alpha_uk^{\beta_u}$$和$$f_i(k)=\alpha_ik^{\beta_i}$$。用一幅图说明，横坐标是用户的活跃度K，纵坐标是活跃度为K的用户数。

![](../.gitbook/assets/image%20%2848%29.png)

#### 2.2.2 用户活跃度和物品流行度的关系

不活跃的用户要么是新用户，要么是只来一两次的老用户。新用户倾向于浏览热门的物品，老用户会逐渐开始浏览冷门的物品。

![](../.gitbook/assets/image%20%2844%29.png)

仅基于用户行为数据设计出的推荐算法称为协同过滤算法。最经典的是基于近邻**neighborhood-based**的方法

* 基于用户的协同过滤算法：给用户推荐和兴趣相似的其他用户喜欢的物品。
* 基于物品的协同过滤算法：给用户推荐和自身之前喜欢的物品的相似的物品。

